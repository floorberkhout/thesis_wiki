<?php/*  Copyright 2011  nonstopgmbh.com,   (http://www.nonstopgmbh.com/)  This program is free software; you can redistribute it and/or modify  it under the terms of the GNU General Public License as published by  the Free Software Foundation; either version 2 of the License, or  (at your option) any later version.  This program is distributed in the hope that it will be useful,  but WITHOUT ANY WARRANTY; without even the implied warranty of  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the  GNU General Public License for more details.  You should have received a copy of the GNU General Public License  along with this program; if not, write to the Free Software  Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA * * * *  Dieses Programm ist freie Software. Sie können es unter den Bedingungen  der GNU General Public License, wie von der Free Software Foundation veröffentlicht,  weitergeben und/oder modifizieren, entweder gemäß Version 3 der Lizenz oder (nach Ihrer Option)  jeder späteren Version.  Die Veröffentlichung dieses Programms erfolgt in der Hoffnung, daß es Ihnen von Nutzen sein wird,  aber OHNE IRGENDEINE GARANTIE, sogar ohne die implizite Garantie der MARKTREIFE oder der  VERWENDBARKEIT FÜR EINEN BESTIMMTEN ZWECK. Details finden Sie in der GNU General Public License.  Sie sollten ein Exemplar der GNU General Public License zusammen mit diesem Programm erhalten haben.  Falls nicht, siehe <http://www.gnu.org/licenses/>. *//* * Benödigt die extension FREEMIND! * Alle Pfade und ggf. die index.php5 in index.php anpassen. * In der db.php die Datenbank Daten eintragen. * Schreibrechte setzen. Zum erstellen der *.mm * Aufruf in den Browser /index.php?task=mm&startkategorie=Ihre Kategorie * z.b. /index.php?task=mm&startkategorie=Hauptkategorie * * DEIN MEDIA WIKI anpassen an dein Wiki Pfad. */require_once ('db.php');$db_link = mysql_connect(MYSQL_HOST, MYSQL_BENUTZER, MYSQL_KENNWORT);mysql_select_db("DEINE WIKI-DATENBANK");// Einbindung ins Mindmapclass MindMap {    public $breite = '1600';    public $hoehe = '800';    public function seite($mm) {        $var_get = $this->sonderzeichen($_GET['startkategorie']);        echo "<a href='$var_get.mm'>Download als Mindmap</a>";        //Den Pfad anpassen (nonstopedia)        $ergebnis = '		<script type="text/javascript" src="/DEIN MEDIA WIKI/extensions/freemind/flashobject.js">		</script>		<div id="flashcontent1"> Flash plugin or Javascript are turned off. Activate both  and reload to view the mindmap</div>		<p><script type="text/javascript">		// <![CDATA[		var fo = new FlashObject("/DEIN MEDIA WIKI/extensions/freemind/visorFreemind.swf", "/DEIN MEDIA WIKI/extensions/freemind/visorFreeMind", "' . $this->breite . '", "' . $this->hoehe . '", 10, "");		fo.addParam("quality", "high");		fo.addParam("bgcolor", "#ffffff");		fo.addVariable("initLoadFile", "' . $mm . '");		fo.addVariable("startCollapsedToLevel", "10");		fo.addVariable("openUrl", "_blank");		fo.write("flashcontent1");		// ]]>		</script>		</p>		';        return $ergebnis;    }    // Sonderzeichen umwandeln    function sonderzeichen($zeichenkette) {        $zeichenkette = str_replace('Ã¼', 'ü', $zeichenkette);        $zeichenkette = str_replace('Ã¶', 'ö', $zeichenkette);        $zeichenkette = str_replace('Ã¤', 'ä', $zeichenkette);        $zeichenkette = str_replace('Ãœ', 'Ü', $zeichenkette);        $zeichenkette = str_replace('Ã–', 'Ö', $zeichenkette);        $zeichenkette = str_replace('Ã„', 'Ä', $zeichenkette);        $zeichenkette = str_replace('ÃŸ', 'ß', $zeichenkette);        $zeichenkette = str_replace(' ', '_', $zeichenkette);        return $zeichenkette;    }}// Auswertung der Datenbank und schreiben den $mm stringclass WikiKategorien extends Datenbank {    private $uid = 0;    private $level = 0;    public function hauptkategorie($kat) {        $file = fopen($_GET['startkategorie'] . ".mm", "w");        ++$this->uid;        $mm = '<map version="0.9.0">			<!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net -->	    	';        $mm .= '<node CREATED="' . date('U') . '" ID="ID_' . $this->uid . '" MODIFIED="' . date('U') . '" TEXT="' . $kat . '" BACKGROUND_COLOR="#e3e3e4">	         <edge WIDTH="2"/>       ';        $mm .= $this->unterkategorien($kat);        $mm .= '</node></map>';        fwrite($file, $mm);        fclose($file);        return $mm;    }    private function unterkategorien($kat) {        ++$this->level;        $sql = "SELECT cl_to, cl_sortkey FROM categorylinks WHERE cl_to = '" . $this->sonderzeichen($kat) . "'";        $daten = $this->abfrage($sql);        $zeilen_anzahl = $this->zeilen_anzahl;        $laenge = $zeilen_anzahl;        $zaehler = 0;        $mm = '';        $link = '';        if ($zeilen_anzahl > 0) {            while ($row = mysql_fetch_assoc($daten)) {                ++$zaehler;                ++$this->uid;                $end[] = $row;                $unterkategorie = $row['cl_sortkey'];                $anzahl_unterkategorien = $this->anzahl_unterknoten($unterkategorie);                $unterkategorie = str_replace('&', '+', $unterkategorie);                //Pfad anpassen ggf. index.php5 in index.php                if ($anzahl_unterkategorien > 0) {                    $bubble = 'STYLE="bubble"';                    $link = 'COLOR="#3333ff" LINK="http://DEIN MEDIA WIKI/index.php5/Kategorie:' . $unterkategorie . '" ';                    $schrift = '<font BOLD="true" NAME="SansSerif" SIZE="12"/>';                    $end_tag = '';                    $hat_unterkatergorien = true;                } else {                    $bubble = 'STYLE="fork"';                    $link = 'COLOR="#3333ff" LINK="http://DEIN MEDIA WIKI/index.php5/' . $unterkategorie . '" ';                    $schrift = '<font BOLD="true" NAME="SansSerif" SIZE="12"/>';                    $end_tag = '/';                    $anzahl_unterkategorien = false;                }                $mm .= '' . $schrift . '<node CREATED="' . date('U') . '" ID="ID_' . $this->uid . '" MODIFIED="' . date('U') . '" ' . $bubble . ' ' . $link . ' TEXT="' . $unterkategorie . '"' . $end_tag . '>                ';                if ($anzahl_unterkategorien > 0) {                    $mm .= $this->unterkategorien($unterkategorie);                }                if ($anzahl_unterkategorien)                    $mm .= '</node>';            }        }        --$this->level;        return $mm;    }    // Sonderzeichen umwandeln    function sonderzeichen($zeichenkette) {        $zeichenkette = str_replace(' ', '_', $zeichenkette);        return $zeichenkette;    }    // Abfrage der Unterkategorien    function anzahl_unterknoten($kat) {        $kat = $this->sonderzeichen($kat);        $sql = 'SELECT count(cl_sortkey) as anzahl FROM categorylinks WHERE cl_to = "' . $kat . '"';        $this->abfrage($sql);        $zeile = $this->zeile();        return $zeile['anzahl'];    }}// Datenbank abfragenclass Datenbank {    public $zeilen_anzahl;    private $daten;    public function abfrage($sql) {        $this->daten = mysql_query($sql);        $this->zeilen_anzahl = mysql_num_rows($this->daten);        return $this->daten;    }    public function zeile() {        $zeile = mysql_fetch_assoc($this->daten);        return $zeile;    }}//Aufruf in den Browser /DEIN MEDIA WIKI/index.php?task=mm&startkategorie=Hauptkategorie//Der Kategorie aufruf ist Variable. Den Pfad anpassen (DEIN MEDIA WIKI)if ($_GET['task'] == 'anzeige') {    $mindmap = new MindMap;    echo $mindmap->seite('/DEIN MEDIA WIKI/index.php?task=mm&startkategorie=' . $_GET['startkategorie'] . '');} else {    $wiki = new WikiKategorien;    // Umwandeln der Sonderzeichen    $_GET['startkategorie'] = str_replace('ü', 'Ã¼', $_GET['startkategorie']);    $_GET['startkategorie'] = str_replace('ö', 'Ã¶', $_GET['startkategorie']);    $_GET['startkategorie'] = str_replace('ä', 'Ã¤', $_GET['startkategorie']);    $_GET['startkategorie'] = str_replace('Ü', 'Ãœ', $_GET['startkategorie']);    $_GET['startkategorie'] = str_replace('Ö', 'Ã–', $_GET['startkategorie']);    $_GET['startkategorie'] = str_replace('Ä', 'Ã„', $_GET['startkategorie']);    $_GET['startkategorie'] = str_replace('ß', 'ÃŸ', $_GET['startkategorie']);    $_GET['startkategorie'] = str_replace(' ', '_', $_GET['startkategorie']);    $kat = $_GET['startkategorie'];    $unterkategorien = $wiki->hauptkategorie($kat);    echo $unterkategorien;}?> 